import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LinearRegression
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_squared_error, r2_score
from statsmodels.stats.outliers_influence import variance_inflation_factor
from statsmodels.tools.tools import add_constant

rent_df = pd.read_csv("./House_Rent_Dataset.csv", encoding='utf-8')

print('–ø—Ä–∏–∫–ª–∞–¥–∏ –¥–∞–Ω–∏—Ö –∑ –ë–î:')
print(rent_df.sample(5))
print('-'*50)
print('–§–æ—Ä–º–∞ –¥–∞–Ω–∏—Ö:')
print(rent_df.shape)
print('-'*50)
print('–ù–∞–∑–≤–∏ –¥–∞–Ω–∏—Ö:')
print(rent_df.columns)
print('-'*50)
print('–¢–∏–ø–∏ –¥–∞–Ω–∏—Ö:')
print(rent_df.info())
print('-'*50)
print('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–∏—Ö:')
print(rent_df.describe())
print('-'*50)
print('–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö  –¥–∞–Ω–∏—Ö:')
print(rent_df.isnull().sum())
print('-'*50)
print('–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤:')
print(rent_df.duplicated().sum())
print('-'*50)

'''
–ú–∞—î–º–æ 12 –∫–æ–ª–æ–Ω–æ–∫ —Ç–∞ 4746 —Ä—è–¥–∫—ñ–≤

–ß–∏—Å–ª–æ–≤—ñ (int64):
BHK ‚Äì –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø–∞–ª–µ–Ω—å
Rent ‚Äì –æ—Ä–µ–Ω–¥–Ω–∞ –ø–ª–∞—Ç–∞
Size ‚Äì –ø–ª–æ—â–∞ –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω–∏—Ö —Ñ—É—Ç–∞—Ö
Bathroom ‚Äì –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∞–Ω–Ω–∏—Ö –∫—ñ–º–Ω–∞—Ç

–ö–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω—ñ (object):
Posted On (–ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –≤ datetime)
Floor (—Ä—è–¥–æ–∫ —Ç–∏–ø—É "2 out of 5" ‚Äì –ø–æ—Ç—Ä–µ–±—É—î —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è)
Area Type (–ø–æ—Ç—Ä–µ–±—É—î –æ–±—Ä–æ–±–∫–∏)
Area Locality (–ø–æ—Ç—Ä–µ–±—É—î –æ–±—Ä–æ–±–∫–∏)
City (–ø–æ—Ç—Ä–µ–±—É—î –æ–±—Ä–æ–±–∫–∏)
Furnishing Status (–ø–æ—Ç—Ä–µ–±—É—î –æ–±—Ä–æ–±–∫–∏)
Tenant Preferred (–ø–æ—Ç—Ä–µ–±—É—î –æ–±—Ä–æ–±–∫–∏)
Point of Contact (–ø–æ—Ç—Ä–µ–±—É—î –æ–±—Ä–æ–±–∫–∏)


–ü—Ä–æ–ø—É—â–µ–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äî –≤—ñ–¥—Å—É—Ç–Ω—ñ
–í–µ–ª–∏–∫–∏–π —Ä–æ–∑–∫–∏–¥ –≤ Rent —ñ Size –º–æ–∂–µ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤–∏–∫–∏–¥—ñ–≤.
'''


print("Mean House Rent:", round(rent_df["Rent"].mean()))
print("Median House Rent:", round(rent_df["Rent"].median()))
print("Highest House Rent:", round(rent_df["Rent"].max()))
print("Lowest House Rent:", round(rent_df["Rent"].min()))
'''
–î–∞–Ω—ñ –º–∞—é—Ç—å –≤–∏—Å–æ–∫—É –∞—Å–∏–º–µ—Ç—Ä—ñ—é —Ç–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤–∏–∫–∏–¥—ñ–≤.
–ú–µ–¥—ñ–∞–Ω–∞ ‚Äî –∫—Ä–∞—â–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ "—Ç–∏–ø–æ–≤–æ—ó" –∫–≤–∞—Ä—Ç–∏—Ä–∏.
 –°–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–≤–∏—â–µ–Ω–µ —á–µ—Ä–µ–∑ –¥–µ–∫—ñ–ª—å–∫–∞ –µ–ª—ñ—Ç–Ω–∏—Ö –¥–æ—Ä–æ–≥–∏—Ö –æ–±'—î–∫—Ç—ñ–≤.
'''
# print(rent_df["Rent"].sort_values(ascending = False)[:5])
# print(rent_df["Rent"].sort_values()[:5])

# –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É –æ—Ä–µ–Ω–¥–Ω–æ—ó –ø–ª–∞—Ç–∏

num_cols = ['BHK', 'Rent', 'Size', 'Bathroom']
for col in num_cols:
    sns.histplot(rent_df[col], kde=True)
    plt.title(f'Distribution of {col}')
    plt.show()

# –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è "Posted On" —É datetime —ñ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ä–æ–∫—É —Ç–∞ –º—ñ—Å—è—Ü—è
rent_df['Posted On'] = pd.to_datetime(rent_df['Posted On'], errors='coerce')
rent_df['Posted Year'] = rent_df['Posted On'].dt.year
rent_df['Posted Month'] = rent_df['Posted On'].dt.month
rent_df.drop(columns='Posted On', inplace=True)

# –û–±—Ä–æ–±–∫–∞ –∫–æ–ª–æ–Ω–∫–∏ "Floor"
def extract_floor_info(floor_str):
    try:
        floor_str = floor_str.strip()
        if 'Ground' in floor_str:
            return 0, int(floor_str.split('out of')[-1])
        elif 'Upper Basement' in floor_str:
            return -1, int(floor_str.split('out of')[-1])
        elif 'Lower Basement' in floor_str:
            return -2, int(floor_str.split('out of')[-1])
        elif 'out of' in floor_str:
            parts = floor_str.split(' out of ')
            return int(parts[0]), int(parts[1])
        else:
            return np.nan, np.nan
    except:
        return np.nan, np.nan

rent_df[['Floor_Level', 'Total_Floors']] = rent_df['Floor'].apply(lambda x: pd.Series(extract_floor_info(str(x))))
rent_df.dropna(subset=['Floor_Level', 'Total_Floors'], inplace=True)
rent_df.drop(columns='Floor', inplace=True)

# –û–±—Ä–æ–±–∫–∞ Area Locality
top_localities = rent_df['Area Locality'].value_counts().nlargest(10).index
rent_df['Area Locality'] = rent_df['Area Locality'].apply(lambda x: x if x in top_localities else 'Other')

# –î–ª—è –≤—Å—ñ—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ One-Hot Encoding, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
categorical_cols = ['Area Type', 'City', 'Furnishing Status', 'Tenant Preferred', 'Point of Contact', 'Area Locality']
rent_df = pd.get_dummies(rent_df, columns=categorical_cols, drop_first=True)

'''–í–∏—Å–Ω–æ–≤–∫–∏:
–î–∞—Ç–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–æ
Floor ‚Äî —Ä–æ–∑–±–∏—Ç–æ –Ω–∞ —á–∏—Å–ª–æ–≤—ñ –æ–∑–Ω–∞–∫–∏
–ë—ñ–Ω–∞—Ä–Ω—ñ/–∫–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ ‚Äî –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –¥–ª—è –∫–æ–¥—É–≤–∞–Ω–Ω—è
–î–∞–Ω—ñ –≥–æ—Ç–æ–≤—ñ –¥–æ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó/–º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è
'''

# –ö–æ—Ä–µ–ª—è—Ü—ñ–π–Ω–∞ –º–∞—Ç—Ä–∏—Ü—è

corr = rent_df.corr(numeric_only=True)
sns.heatmap(corr, annot=False, cmap='coolwarm')
# sns.heatmap(corr, annot=True, cmap='coolwarm')
plt.title("Correlation Heatmap")
plt.show()
'''
–¶–µ –ø–æ–∫–∞–∑—É—î –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –∑–º—ñ–Ω–∞ –æ–¥–Ω—ñ—î—ó –∑–º—ñ–Ω–Ω–æ—ó –ø–æ–≤‚Äô—è–∑–∞–Ω–∞ –∑—ñ –∑–º—ñ–Ω–æ—é —ñ–Ω—à–æ—ó:

+1.0 ‚Äî —ñ–¥–µ–∞–ª—å–Ω–∞ –ø—Ä—è–º–∞ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å

-1.0 ‚Äî —ñ–¥–µ–∞–ª—å–Ω–∞ –æ–±–µ—Ä–Ω–µ–Ω–∞ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å

0 ‚Äî –Ω–µ–º–∞—î –ª—ñ–Ω—ñ–π–Ω–æ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

Rent –Ω–∞–π–±—ñ–ª—å—à –ø–æ–∑–∏—Ç–∏–≤–Ω–æ –∫–æ—Ä–µ–ª—é—î –∑:
Size (—Ä–æ–∑–º—ñ—Ä –∫–≤–∞—Ä—Ç–∏—Ä–∏)
Bathroom (–∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∞–Ω–Ω–∏—Ö –∫—ñ–º–Ω–∞—Ç)
BHK (–∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø–∞–ª–µ–Ω—å)

Rent —Å–ª–∞–±–æ –∞–±–æ –º–∞–π–∂–µ –Ω–µ –∫–æ—Ä–µ–ª—é—î –∑:
Total_Floors —á–∏ Floor_Level (–µ—Ç–∞–∂–Ω—ñ—Å—Ç—å), —Ö–æ—á–∞ —ñ–Ω–æ–¥—ñ –º–æ–∂–µ –±—É—Ç–∏ –∑–Ω–∞—á—É—â–∏–º —É –≤–µ–ª–∏–∫–∏—Ö –º—ñ—Å—Ç–∞—Ö.
Posted Month ‚Äî —â–æ –ª–æ–≥—ñ—á–Ω–æ, –±–æ –º—ñ—Å—è—Ü—å –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó –Ω–µ –∑–∞–≤–∂–¥–∏ –≤–∏–∑–Ω–∞—á–∞—î —Ü—ñ–Ω—É.
–Ø–∫—â–æ —î –æ–¥–Ω–∞–∫–æ–≤—ñ –æ–∑–Ω–∞–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Size —ñ BHK —á–∞—Å—Ç–æ –π–¥—É—Ç—å —Ä–∞–∑–æ–º), —Ç–æ –º—ñ–∂ –Ω–∏–º–∏ –±—É–¥–µ —Ç–∞–∫–æ–∂ –≤–∏—Å–æ–∫–∞ –∫–æ—Ä–µ–ª—è—Ü—ñ—è ‚Üí –º–æ–∂–µ –±—É—Ç–∏ –º—É–ª—å—Ç–∏–∫–æ–ª—ñ–Ω–µ–∞—Ä–Ω—ñ—Å—Ç—å (–¥–ª—è –ª—ñ–Ω—ñ–π–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π —Ü–µ –ø–æ–≥–∞–Ω–æ).


'''


# Parth 2.

# –§–æ—Ä–º—É–≤–∞–Ω–Ω—è X —Ç–∞ y
X = rent_df.drop(columns=['Rent'])
y = rent_df['Rent']

# –†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è —Ç–∞ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

# –ú–æ–¥–µ–ª—å 1: –õ—ñ–Ω—ñ–π–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è
lin_reg = LinearRegression()
lin_reg.fit(X_train_scaled, y_train)
y_pred_lin = lin_reg.predict(X_test_scaled)
mse_lin = mean_squared_error(y_test, y_pred_lin) # —Å–µ—Ä–µ–¥–Ω—î –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è
r2_lin = r2_score(y_test, y_pred_lin) # –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–µ—Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—ó

# –ú–æ–¥–µ–ª—å 2: Random Forest
rf = RandomForestRegressor(n_estimators=100, random_state=42)
rf.fit(X_train, y_train)
y_pred_rf = rf.predict(X_test)
mse_rf = mean_squared_error(y_test, y_pred_rf)  # —Å–µ—Ä–µ–¥–Ω—î –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è
r2_rf = r2_score(y_test, y_pred_rf) # –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–µ—Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—ó

# –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è
plt.figure(figsize=(14, 6))

plt.subplot(1, 2, 1)
sns.scatterplot(x=y_test, y=y_pred_lin)
plt.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], 'r--')
plt.title('–õ—ñ–Ω—ñ–π–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è: –°–ø—Ä–∞–≤–∂–Ω—î vs –ü—Ä–æ–≥–Ω–æ–∑')
plt.xlabel("–°–ø—Ä–∞–≤–∂–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è")
plt.ylabel("–ü—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è")

plt.subplot(1, 2, 2)
sns.scatterplot(x=y_test, y=y_pred_rf)
plt.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], 'r--')
plt.title('Random Forest: –°–ø—Ä–∞–≤–∂–Ω—î vs –ü—Ä–æ–≥–Ω–æ–∑')
plt.xlabel("–°–ø—Ä–∞–≤–∂–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è")
plt.ylabel("–ü—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è")

plt.tight_layout()
plt.show()

# –ú–µ—Ç—Ä–∏–∫–∏
print("–õ—ñ–Ω—ñ–π–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è:")
print(f"MSE: {mse_lin:.2f}")
print(f"R¬≤: {r2_lin:.4f}")

print("Random Forest:")
print(f"MSE: {mse_rf:.2f}")
print(f"R¬≤: {r2_rf:.4f}")

'''
1. Mean Squared Error (MSE)
MSE ‚Äî —Ü–µ —Å–µ—Ä–µ–¥–Ω—î –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –º—ñ–∂ —Å–ø—Ä–∞–≤–∂–Ω—ñ–º–∏ —Ç–∞ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏:

–ß–∏–º –º–µ–Ω—à–µ MSE, —Ç–∏–º —Ç–æ—á–Ω—ñ—à–∏–π –ø—Ä–æ–≥–Ω–æ–∑.

–í–∏–º—ñ—Ä—é—î—Ç—å—Å—è —É –∫–≤–∞–¥—Ä–∞—Ç–Ω–∏—Ö –æ–¥–∏–Ω–∏—Ü—è—Ö —Ü—ñ–ª—å–æ–≤–æ—ó –∑–º—ñ–Ω–Ω–æ—ó ‚Äî —Ç–æ–±—Ç–æ —Ç—É—Ç —É –∫–≤–∞–¥—Ä–∞—Ç–Ω–∏—Ö —Ä—É–ø—ñ—è—Ö.

–ú–æ–¥–µ–ª—å	MSE (–º–µ–Ω—à–µ ‚Äî –∫—Ä–∞—â–µ)
–õ—ñ–Ω—ñ–π–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è	1,847,380,849
Random Forest	1,417,235,287 

Random Forest —Ç–æ—á–Ω—ñ—à–µ –ø—Ä–æ–≥–Ω–æ–∑—É—î –æ—Ä–µ–Ω–¥–Ω—É –ø–ª–∞—Ç—É, –º–∞—î –º–µ–Ω—à–µ —Å–µ—Ä–µ–¥–Ω—î –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è.

2. R¬≤ (–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–µ—Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—ó)
–ü–æ–∫–∞–∑—É—î, —è–∫–∞ —á–∞—Å—Ç–∫–∞ –≤–∞—Ä—ñ–∞—Ü—ñ—ó —Ü—ñ–ª—å–æ–≤–æ—ó –∑–º—ñ–Ω–Ω–æ—ó –ø–æ—è—Å–Ω—é—î—Ç—å—Å—è –º–æ–¥–µ–ª–ª—é.

–ó–Ω–∞—á–µ–Ω–Ω—è –≤—ñ–¥ 0 –¥–æ 1 (—ñ–Ω–æ–¥—ñ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥‚Äô—î–º–Ω–∏–º –ø—Ä–∏ –¥—É–∂–µ –ø–æ–≥–∞–Ω—ñ–π –º–æ–¥–µ–ª—ñ):

0 ‚Äî –º–æ–¥–µ–ª—å –Ω—ñ—á–æ–≥–æ –Ω–µ –ø–æ—è—Å–Ω—é—î

1 ‚Äî –º–æ–¥–µ–ª—å –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–æ—è—Å–Ω—é—î –¥–∞–Ω—ñ

> 0.5 ‚Äî –ø—Ä–∏–π–Ω—è—Ç–Ω–∞ –º–æ–¥–µ–ª—å

–ú–æ–¥–µ–ª—å	R¬≤ (–±—ñ–ª—å—à–µ ‚Äî –∫—Ä–∞—â–µ)
–õ—ñ–Ω—ñ–π–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è	0.5501
Random Forest	0.6548 

Random Forest –∫—Ä–∞—â–µ "–≤–ª–æ–≤–ª—é—î" –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º—ñ–∂ –æ–∑–Ω–∞–∫–∞–º–∏ —ñ —Ä–µ–Ω—Ç–æ—é.

–ß–æ–º—É —Ç–∞–∫?
–õ—ñ–Ω—ñ–π–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è ‚Äî –¥—É–∂–µ –ø—Ä–æ—Å—Ç–∞ –º–æ–¥–µ–ª—å, —è–∫–∞ –ø–µ—Ä–µ–¥–±–∞—á–∞—î –ª–∏—à–µ –ª—ñ–Ω—ñ–π–Ω—ñ –∑–≤'—è–∑–∫–∏. –í–æ–Ω–∞ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ–¥–æ—Ü—ñ–ª—å–Ω–æ—é –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –≤–∑–∞—î–º–æ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –º—ñ–∂ –æ–∑–Ω–∞–∫–∞–º–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–µ–ª—ñ–Ω—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤ –ø–ª–æ—â—ñ, –ø–æ–≤–µ—Ä—Ö—É, —Ç–∏–ø—É –º–µ–±–ª—ñ–≤ —Ç–æ—â–æ).

Random Forest ‚Äî –∞–Ω—Å–∞–º–±–ª–µ–≤–∞ –º–æ–¥–µ–ª—å, —è–∫–∞ –≤—Ä–∞—Ö–æ–≤—É—î –≤–∑–∞—î–º–æ–¥—ñ—ó –º—ñ–∂ –æ–∑–Ω–∞–∫–∞–º–∏ —Ç–∞ –Ω–µ–ª—ñ–Ω—ñ–π–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, —ñ —Ç–æ–º—É –¥–∞—î –∫—Ä–∞—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–í–∏—Å–Ω–æ–≤–∫–∏:
–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è	–í–∏—Å–Ω–æ–≤–æ–∫
–Ø–∫—ñ—Å—Ç—å	Random Forest —Ç–æ—á–Ω—ñ—à–∏–π –∑–∞ –≤—Å—ñ–º–∞ –º–µ—Ç—Ä–∏–∫–∞–º–∏.
–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å	Random Forest —Å–∫–ª–∞–¥–Ω—ñ—à–∏–π —É –Ω–∞–≤—á–∞–Ω–Ω—ñ.
–Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å	–õ—ñ–Ω—ñ–π–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è –ø—Ä–æ—Å—Ç—ñ—à–∞ –¥–ª—è –ø–æ—è—Å–Ω–µ–Ω–Ω—è.
'''

# --- VIF (Multicollinearity)
X_const = add_constant(X_train_scaled)
vif_data = pd.DataFrame()
vif_data['Feature'] = X.columns
vif_data['VIF'] = [variance_inflation_factor(X_const, i+1) for i in range(X.shape[1])]
print("\nüìå VIF (Multicollinearity):")
print(vif_data.sort_values(by='VIF', ascending=False))

# --- GridSearch for RandomForest
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
param_grid = {
    'n_estimators': [50, 100],
    'max_depth': [10, 20, None],
    'min_samples_split': [2, 5],
}
rf = RandomForestRegressor(random_state=42)
grid_search = GridSearchCV(estimator=rf, param_grid=param_grid, cv=3, scoring='r2', n_jobs=-1)
grid_search.fit(X_train, y_train)
best_rf = grid_search.best_estimator_

print("\n –ù–∞–π–∫—Ä–∞—â—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ RandomForest:")
print(grid_search.best_params_)

# --- Feature Importance
feature_importance = pd.Series(best_rf.feature_importances_, index=X.columns).sort_values(ascending=False)
print("\nüîù –¢–æ–ø-10 –≤–∞–∂–ª–∏–≤–∏—Ö –æ–∑–Ω–∞–∫:")
print(feature_importance.head(10))

# --- Residual Plot
y_pred = best_rf.predict(X_test)
residuals = y_test - y_pred
plt.figure(figsize=(10, 6))
sns.scatterplot(x=y_pred, y=residuals)
plt.axhline(0, color='red', linestyle='--')
plt.xlabel("–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∞ –æ—Ä–µ–Ω–¥–∞ (Predicted Rent)")
plt.ylabel("–ó–∞–ª–∏—à–∫–∏ (Residuals)")
plt.title("–ì—Ä–∞—Ñ—ñ–∫ –∑–∞–ª–∏—à–∫—ñ–≤ Random Forest")
plt.tight_layout()
plt.show()
'''
–í–∏—Å–Ω–æ–≤–æ–∫ –ø–æ Random Forest:
–û–∑–Ω–∞–∫–∞	–Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è
–ó–∞–ª–∏—à–∫–∏ –≤–∏–ø–∞–¥–∫–æ–≤—ñ	 –ú–æ–¥–µ–ª—å –¥–æ–±—Ä–µ –≤–ª–æ–≤–ª—é—î –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
–ù–µ–º–∞—î —Ç—Ä–µ–Ω–¥—ñ–≤	 –ù–µ–º–∞—î –æ–∑–Ω–∞–∫ –Ω–µ–¥–æ–æ–±—É—á–µ–Ω–Ω—è –∞–±–æ –ø–µ—Ä–µ–∫–æ—Å—ñ–≤
–ü–æ–º–∏–ª–∫–∏ –Ω–∞ –∫—Ä–∞–π–Ω—ñ—Ö –∑–Ω–∞—á–µ–Ω–Ω—è—Ö	–ß–∞—Å—Ç–æ —Ç—Ä–∞–ø–ª—è—î—Ç—å—Å—è, –±–æ Random Forest –æ–±–º–µ–∂—É—î –µ–∫—Å—Ç—Ä–∞–ø–æ–ª—è—Ü—ñ—é

–°–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –∑  –≥—Ä–∞—Ñ—ñ–∫–∞:
–ù–∞ —Å–µ—Ä–µ–¥–Ω—ñ—Ö —ñ –Ω–∏–∂—á–∏—Ö –∑–Ω–∞—á–µ–Ω–Ω—è—Ö –æ—Ä–µ–Ω–¥–∏ ‚Äî –ø–æ–º–∏–ª–∫–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ.

–ù–∞ –¥—É–∂–µ –¥–æ—Ä–æ–≥–∏—Ö –∫–≤–∞—Ä—Ç–∏—Ä–∞—Ö ‚Äî –ø–æ–º–∏–ª–∫–∏ –±—ñ–ª—å—à—ñ, –º–æ–¥–µ–ª—å –Ω–µ–¥–æ–æ—Ü—ñ–Ω—é—î —ó—Ö (—á–∞—Å—Ç–æ —á–µ—Ä–µ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è –≥–ª–∏–±–∏–Ω–∏ –¥–µ—Ä–µ–≤–∞ —Ç–∞ –≤–ø–ª–∏–≤—É –º–µ–Ω—à–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö).
'''


'''
–ú—É–ª—å—Ç–∏–∫–æ–ª—ñ–Ω–µ–∞—Ä–Ω—ñ—Å—Ç—å (VIF ‚Äì Variance Inflation Factor)
–©–æ —Ü–µ —Ç–∞–∫–µ:
VIF –ø–æ–∫–∞–∑—É—î, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –æ–¥–Ω–∞ –æ–∑–Ω–∞–∫–∞ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —ñ–Ω—à–∏—Ö –æ–∑–Ω–∞–∫.

–Ø–∫—â–æ VIF > 5 (–∞–±–æ 10), —Ü–µ –æ–∑–Ω–∞–∫–∞ –º—É–ª—å—Ç–∏–∫–æ–ª—ñ–Ω–µ–∞—Ä–Ω–æ—Å—Ç—ñ ‚Äî —Ç–æ–±—Ç–æ –æ–∑–Ω–∞–∫–∞ –Ω–∞–¥—Ç–æ —Å–∏–ª—å–Ω–æ –∫–æ—Ä–µ–ª—é—î –∑ —ñ–Ω—à–∏–º–∏ i –º–æ–∂–µ –∑–∞–≤–∞–∂–∞—Ç–∏ –º–æ–¥–µ–ª—ñ.

 –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è:
VIF	–Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è
~1	–û–∑–Ω–∞–∫–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω–∞ –≤—ñ–¥ —ñ–Ω—à–∏—Ö
1‚Äì5	–°–ª–∞–±–∫–∞ –º—É–ª—å—Ç–∏–∫–æ–ª—ñ–Ω–µ–∞—Ä–Ω—ñ—Å—Ç—å
>5 –∞–±–æ >10	–°–∏–ª—å–Ω–∞ –º—É–ª—å—Ç–∏–∫–æ–ª—ñ–Ω–µ–∞—Ä–Ω—ñ—Å—Ç—å 

–í–∏—Å–Ω–æ–≤–æ–∫: –Ø–∫—â–æ –æ–∑–Ω–∞–∫ –∑ VIF > 10 –∫—ñ–ª—å–∫–∞ ‚Äî –≤–∞—Ä—Ç–æ –∞–±–æ –≤–∏–¥–∞–ª–∏—Ç–∏, –∞–±–æ –æ–±'—î–¥–Ω–∞—Ç–∏, –∞–±–æ –∑–º–µ–Ω—à–∏—Ç–∏ —á–µ—Ä–µ–∑ PCA.

GridSearchCV –¥–ª—è Random Forest
‚ñ∂ –©–æ —Ü–µ —Ç–∞–∫–µ:
–ü–µ—Ä–µ–±—ñ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ max_depth, n_estimators, min_samples_split –¥–ª—è –ø—ñ–¥–±–æ—Ä—É –Ω–∞–π–∫—Ä–∞—â–æ—ó –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –≥—ñ–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤.

–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–∏—Ä–∞—î –Ω–∞–π–∫—Ä–∞—â—É –º–æ–¥–µ–ª—å –Ω–∞ –∫—Ä–æ—Å-–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó.

‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫:
–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è —è–∫–æ—Å—Ç—ñ –ø—Ä–æ–≥–Ω–æ–∑—É.

–£–Ω–∏–∫–∞—î –ø–µ—Ä–µ/–Ω–µ–¥–æ–æ–±—É—á–µ–Ω–Ω—è –∑–∞ —Ä–∞—Ö—É–Ω–æ–∫ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å.

3. –í–∞–∂–ª–∏–≤—ñ—Å—Ç—å –æ–∑–Ω–∞–∫ (Feature Importance)
‚ñ∂ –©–æ —Ü–µ:
Random Forest –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ü—ñ–Ω—é—î, —è–∫—ñ –æ–∑–Ω–∞–∫–∏ –Ω–∞–π—Å–∏–ª—å–Ω—ñ—à–µ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —Ü—ñ–ª—å–æ–≤—É –∑–º—ñ–Ω–Ω—É (Rent).

–í–∞–∂–ª–∏–≤—ñ—Å—Ç—å ‚Äî —É –≤—ñ–¥—Å–æ—Ç–∫–∞—Ö –≤—ñ–¥ –≤–ø–ª–∏–≤—É –Ω–∞ —Ä—ñ—à–µ–Ω–Ω—è –¥–µ—Ä–µ–≤–∞.

‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫:
–ù–∞–π–≤–ø–ª–∏–≤–æ–≤—ñ—à—ñ –æ–∑–Ω–∞–∫–∏ –º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ –≤ –º–æ–¥–µ–ª—ñ (–¥–ª—è —Å–ø—Ä–æ—â–µ–Ω–Ω—è —Ç–∞ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—ó).

–ú–∞–ª–æ–∑–Ω–∞—á—É—â—ñ ‚Äî –≤–∏–¥–∞–ª–∏—Ç–∏ –∞–±–æ –∑–º–µ–Ω—à–∏—Ç–∏ –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è "—à—É–º—É".

–ü—Ä–∏–∫–ª–∞–¥ —Ç–∏–ø–æ–≤–∏—Ö —Ç–æ–ø-–æ–∑–Ω–∞–∫:

Size (—Ä–æ–∑–º—ñ—Ä –ø–ª–æ—â—ñ)

BHK (–∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫—ñ–º–Ω–∞—Ç)

Bathroom

Floor_Level

City_<...> (–º—ñ—Å—Ç–æ)

4. –ì—Ä–∞—Ñ—ñ–∫ –∑–∞–ª–∏—à–∫—ñ–≤ (Residuals Plot)
‚ñ∂ –©–æ —Ü–µ:
–ü–æ–∫–∞–∂—á–∏–∫ —è–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—å.

–ó–∞–ª–∏—à–∫–∏ = –°–ø—Ä–∞–≤–∂–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äì –ü—Ä–æ–≥–Ω–æ–∑.

–Ü–¥–µ–∞–ª—å–Ω–æ: –∑–∞–ª–∏—à–∫–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ –≤–∏–ø–∞–¥–∫–æ–≤–æ –Ω–∞–≤–∫–æ–ª–æ 0.

–Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è:
–û–∑–Ω–∞–∫–∞	–©–æ –æ–∑–Ω–∞—á–∞—î
–†—ñ–≤–Ω–æ–º—ñ—Ä–Ω–µ —Ä–æ–∑—Å—ñ—é–≤–∞–Ω–Ω—è	–ú–æ–¥–µ–ª—å –∞–¥–µ–∫–≤–∞—Ç–Ω–∞ 
–í—ñ—è–ª–æ–ø–æ–¥—ñ–±–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞	–í–∞—Ä—ñ–∞—Ü—ñ—è –Ω–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–∞ (–≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å) 
–°–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π –º–∞–ª—é–Ω–æ–∫	–ú–æ–¥–µ–ª—å —â–æ—Å—å –Ω–µ –≤–ª–æ–≤–ª—é—î ‚Äî –º–æ–∂–ª–∏–≤–æ, —Ç—Ä–µ–±–∞ —ñ–Ω—à—É –º–æ–¥–µ–ª—å

üßæ –ó–∞–≥–∞–ª—å–Ω–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫:
–ê–Ω–∞–ª—ñ–∑	–í–∏—Å–Ω–æ–≤–æ–∫
‚úÖ VIF	–í–∏—è–≤–∏—Ç–∏ –æ–∑–Ω–∞–∫–∏ –∑ –Ω–∞–¥–ª–∏—à–∫–æ–≤–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
‚úÖ GridSearch	–ó–Ω–∞–π–¥–µ–Ω–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ Random Forest
‚úÖ Feature Importance	–í–∏–¥—ñ–ª–µ–Ω–æ –∫–ª—é—á–æ–≤—ñ –æ–∑–Ω–∞–∫–∏, —è–∫—ñ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å –æ—Ä–µ–Ω–¥–∏
‚úÖ Residuals Plot	–î–∞—î —É—è–≤–ª–µ–Ω–Ω—è –ø—Ä–æ —è–∫—ñ—Å—Ç—å –º–æ–¥–µ–ª—ñ —Ç–∞ —ó—ó –ø–æ—Ö–∏–±–∫–∏

üîß –©–æ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –¥–∞–ª—ñ:

–í–∏–¥–∞–ª–∏—Ç–∏ –∞–±–æ –æ–±'—î–¥–Ω–∞—Ç–∏ –≤–∏—Å–æ–∫–æ–∫–æ—Ä–µ–ª—å–æ–≤–∞–Ω—ñ –æ–∑–Ω–∞–∫–∏.

–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –º–æ–¥–µ–ª—ñ LightGBM –∞–±–æ XGBoost.

–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –∫—Ä–æ—Å-–≤–∞–ª—ñ–¥–∞—Ü—ñ—é –¥–ª—è –≤—Å—ñ—Ö –º–µ—Ç—Ä–∏–∫.
'''

# –û–∑–Ω–∞–∫–∏ –∑ –≤–∏—Å–æ–∫–∏–º VIF (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, VIF > 5)
vif_data_sorted = vif_data.sort_values(by='VIF', ascending=False)
high_vif_features = vif_data_sorted[vif_data_sorted['VIF'] > 5]
print("‚ö†Ô∏è –û–∑–Ω–∞–∫–∏ –∑ –≤–∏—Å–æ–∫–∏–º —Ä—ñ–≤–Ω–µ–º –º—É–ª—å—Ç–∏–∫–æ–ª—ñ–Ω–µ–∞—Ä–Ω–æ—Å—Ç—ñ (VIF > 5):")
print(high_vif_features)

# –ì—Ä–∞—Ñ—ñ–∫ –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ –æ–∑–Ω–∞–∫ (—Ç–æ–ø-20)
import matplotlib.pyplot as plt

plt.figure(figsize=(10, 8))
feature_importance.head(20).sort_values().plot(kind='barh', color='skyblue')
plt.xlabel("Feature Importance")
plt.title("üîù –¢–æ–ø-20 –≤–∞–∂–ª–∏–≤–∏—Ö –æ–∑–Ω–∞–∫ (Random Forest)")
plt.tight_layout()
plt.show()

'''
–¢–∏–ø –æ–∑–Ω–∞–∫	–î—ñ—è
üü• Area Type_Carpet Area —ñ Area Type_Super Area	‚ùó –í–∏–¥–∞–ª–∏—Ç–∏ –æ–¥–Ω—É –∞–±–æ –æ–±–∏–¥–≤—ñ –¥–ª—è —É—Å—É–Ω–µ–Ω–Ω—è –º—É–ª—å—Ç–∏–∫–æ–ª—ñ–Ω–µ–∞—Ä–Ω–æ—Å—Ç—ñ
üü® Bathroom, BHK, Size, Total_Floors, Floor_Level	üîÑ –ù–µ–æ–±—Ö—ñ–¥–Ω–æ –≤—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É–≤–∞—Ç–∏ —ó—Ö–Ω—ñ–π –≤–ø–ª–∏–≤ ‚Äî –≤–æ–Ω–∏ –ª–æ–≥—ñ—á–Ω–æ –∫–æ—Ä–µ–ª—å–æ–≤–∞–Ω—ñ
üü© –Ü–Ω—à—ñ –æ–∑–Ω–∞–∫–∏ (–º—ñ—Å—Ç–æ, –∫–æ–Ω—Ç–∞–∫—Ç, –º–µ–±–ª—é–≤–∞–Ω–Ω—è)	‚úÖ –ú–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ ‚Äî –º–∞—é—Ç—å –Ω–∏–∑—å–∫—É –º—É–ª—å—Ç–∏–∫–æ–ª—ñ–Ω–µ–∞—Ä–Ω—ñ—Å—Ç—å
üü´ Posted Year	‚ùî –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ ‚Äî –º–æ–∂–ª–∏–≤–æ, –º–∞—î –æ–¥–Ω—É —É–Ω—ñ–∫–∞–ª—å–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
'''